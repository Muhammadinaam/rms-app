<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">

    <section class="content-header">
        <h1>
            Order
            <!-- <small>Version 2.0</small> -->

        </h1>

    </section>

    <section class="content">

        <div class="row">

            <div class="col-md-12">
                <div class="box box-primary">

                    <div style="background-color:#ecf0f5;" class="box-body">

                        <form #f="ngForm" (ngSubmit)="onSubmit(f.value, form_type)" (keydown.enter)="$event.preventDefault()" class="form-horizontal" role="form">

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="box box-success">
                                        <div class="box-header with-border">
                                            <h3 class="box-title">Order Information</h3>
                                        </div>

                                        <div class="box-body">

                                            <div class="form-group">
                                                <label for="order_type" class="col-sm-2 control-label">Order Type:</label>
                                                <div class="col-sm-10">
                                                    <select name="order_type" id="order_type" class="form-control input-md" [(ngModel)]="order.order_type" required="required" #order_type_input=ngModel>
                                                        <option *ngFor="let order_type of order_types" [value]="order_type.id">{{order_type.name}}</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <ng-template let-table_required [ngTemplateOutletContext]="{ $implicit: order_type_input.value == '1' }" [ngTemplateOutlet]="table" #table>
                                                <div *ngIf="table_required" class="form-group">
                                                    <label for="table" class="col-sm-2 control-label">Table:</label>
                                                    <div class="col-sm-10">
                                                        <select name="table" id="table" class="form-control input-md" [(ngModel)]="order.table" #table_input=ngModel [required]="table_required">
                                                        <option *ngFor="let free_table of free_tables" [value]="free_table.id">{{ free_table.portion + ' | ' + free_table.name }}</option>
                                                    </select>
                                                        <div class="validation-error" *ngIf="table_input.errors?.required">
                                                            Should not be empty.
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-template>

                                        </div>
                                    </div>
                                </div>

                                <ng-template let-cust_info_required [ngTemplateOutletContext]="{ $implicit: order_type_input.value == '2' || order_type_input.value == '3' }" [ngTemplateOutlet]="customer" #customer>
                                    <div *ngIf="cust_info_required" class="col-sm-6">
                                        <div class="box box-danger">
                                            <div class="box-header with-border">
                                                <h3 class="box-title">Customer Information</h3>
                                            </div>

                                            <div class="box-body">

                                                <div class="form-group">
                                                    <label class="control-label col-sm-2" for="deliver_to_name">Name</label>
                                                    <div class="col-sm-10">
                                                        <input type="text" class="form-control input-md" id="deliver_to_name" name="deliver_to_name" [(ngModel)]="order.deliver_to_name" #deliver_to_name_input=ngModel [required]="cust_info_required">
                                                        <div class="validation-error" *ngIf="deliver_to_name_input.errors?.required">
                                                            Should not be empty.
                                                        </div>
                                                    </div>
                                                </div>

                                                <ng-template let-delivery_info_required [ngTemplateOutletContext]="{ $implicit: order_type_input.value == '3' }" [ngTemplateOutlet]="delivery" #delivery>

                                                    <div class="form-group">
                                                        <label class="control-label col-sm-2" for="deliver_to_phone">Phone</label>
                                                        <div class="col-sm-10">
                                                            <input type="text" class="form-control input-md" id="deliver_to_phone" name="deliver_to_phone" [(ngModel)]="order.deliver_to_phone" #deliver_to_phone_input=ngModel [required]="delivery_info_required">
                                                            <div class="validation-error" *ngIf="deliver_to_phone_input.errors?.required">
                                                                Should not be empty.
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-sm-2" for="deliver_to_address">Address</label>
                                                        <div class="col-sm-10">
                                                            <input type="text" class="form-control input-md" id="deliver_to_address" name="deliver_to_address" [(ngModel)]="order.deliver_to_address" #deliver_to_address_input=ngModel [required]="delivery_info_required">
                                                            <div class="validation-error" *ngIf="deliver_to_address_input.errors?.required">
                                                                Should not be empty.
                                                            </div>
                                                        </div>
                                                    </div>

                                                </ng-template>




                                            </div>
                                        </div>
                                    </div>
                                </ng-template>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">

                                    <div class="box box-warning">

                                        <div class="box-header with-border">
                                            <h3 class="box-title">Items</h3>
                                        </div>

                                        <div class="box-body">

                                            <table class="table table-bordered table-condensed table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Item</th>
                                                        <th style="width:100px;">Qty</th>
                                                        <th style="width:100px;">Rate</th>
                                                        <th style="width:100px;">Amount</th>
                                                        <th style="width:100px;">Add / Remove</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let order_detail of order.order_details; let i = index;">
                                                        <td>{{ order_detail.item_name }}</td>
                                                        <td>{{ order_detail.qty }}</td>
                                                        <td>{{ order_detail.rate }}</td>
                                                        <td>{{ order_detail.qty * order_detail.rate }}</td>
                                                        <td>
                                                            <button (click)="removeItem(i)" type="button" class="btn btn-danger"><i class="fa fa-times-circle"></i></button>
                                                        </td>
                                                    </tr>
                                                </tbody>

                                                <tfoot>
                                                    <tr>
                                                        <td>
                                                            <select id="new_item_select" (change)="newItemChanged($event)" [(ngModel)]="new_item.id" [ngModelOptions]="{standalone: true}" class="form-control input-md">
                                                                <option *ngFor="let item of items" [value]="item.id">{{item.code + " | " + item.name + " ("+item.unit+")" }}</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <input type="number" min=0 [(ngModel)]="new_item.qty" [ngModelOptions]="{standalone: true}" class="form-control input-md">
                                                        </td>
                                                        <td>
                                                            <input type="number" [(ngModel)]="new_item.rate" [ngModelOptions]="{standalone: true}" class="form-control input-md" readonly>
                                                        </td>
                                                        <td>
                                                            <input type="number" [value]="new_item.qty * new_item.rate" class="form-control input-md" readonly>
                                                        </td>
                                                        <td>
                                                            <button type="button" (click)="addNewItem()" class="btn btn-success"><i class="fa fa-plus-circle"></i></button>
                                                            <button type="button" (click)="resetNewItem()" class="btn btn-primary"> <i class="fa fa-times-circle-o"></i> </button>
                                                        </td>
                                                    </tr>
                                                </tfoot>
                                            </table>

                                        </div>

                                    </div>

                                </div>
                            </div>







                            

                            <div class="form-group">
                                <div class="col-sm-12 text-right">
                                    <button type="submit" [disabled]="!f.form.valid || is_loading || new_item.id != 0" class="btn btn-primary"> <i class="fa fa-save"></i> Save</button>
                                </div>
                            </div>
                            <div *ngIf="new_item.id != 0 " class="text-danger text-right">
                                Please Add or Clear Last Item to enable save button    
                            </div>
                        </form>

                    </div>

                </div>
            </div>

        </div>

    </section>


</div>
<!-- /.content-wrapper -->